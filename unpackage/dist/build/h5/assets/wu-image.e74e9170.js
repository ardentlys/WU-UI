var t,e;import{m as i,k as s,o as a,c as o,w as n,l as r,p as d,q as l,u as h,d as u,r as c,a as m,g}from"./index-11e68488.js";import{_ as w}from"./wu-icon.d51d82ec.js";import{r as p}from"./uni-app.es.0596e349.js";import{_ as y}from"./_plugin-vue_export-helper.1b428a4d.js";const f={props:{show:{type:Boolean,default:!1},mode:{type:String,default:"fade"},duration:{type:[String,Number],default:300},timingFunction:{type:String,default:"ease-out"},...null==(e=null==(t=uni.$w)?void 0:t.props)?void 0:e.transition}},$=t=>({enter:`wu-${t}-enter wu-${t}-enter-active`,"enter-to":`wu-${t}-enter-to wu-${t}-enter-active`,leave:`wu-${t}-leave wu-${t}-leave-active`,"leave-to":`wu-${t}-leave-to wu-${t}-leave-active`});const v=y({name:"wu-transition",data:()=>({inited:!1,viewStyle:{},status:"",transitionEnded:!1,display:!1,classes:""}),computed:{mergeStyle(){const{viewStyle:t,customStyle:e}=this;return{transitionDuration:this.duration+"ms",transitionTimingFunction:this.timingFunction,...this.$w.addStyle(e),...t}}},mixins:[i,s,{methods:{clickHandler(){this.$emit("click")},vueEnter(){const t=$(this.mode);this.status="enter",this.$emit("beforeEnter"),this.inited=!0,this.display=!0,this.classes=t.enter,this.$nextTick(async()=>{await this.$w.sleep(20),this.$emit("enter"),this.transitionEnded=!1,this.$emit("afterEnter"),this.classes=t["enter-to"]})},vueLeave(){if(!this.display)return;const t=$(this.mode);this.status="leave",this.$emit("beforeLeave"),this.classes=t.leave,this.$nextTick(()=>{this.transitionEnded=!1,this.$emit("leave"),setTimeout(this.onTransitionEnd,this.duration),this.classes=t["leave-to"]})},onTransitionEnd(){this.transitionEnded||(this.transitionEnded=!0,this.$emit("leave"===this.status?"afterLeave":"afterEnter"),!this.show&&this.display&&(this.display=!1,this.inited=!1))}}},f],watch:{show:{handler(t){t?this.vueEnter():this.vueLeave()},immediate:!0}}},[["render",function(t,e,i,s,c,m){const g=u;return c.inited?(a(),o(g,{key:0,class:d(["wu-transition",[c.classes,t.customClass]]),onClick:t.clickHandler,style:l([m.mergeStyle]),onTouchmove:t.noop},{default:n(()=>[r(t.$slots,"default",{},void 0,!0)]),_:3},8,["onClick","class","style","onTouchmove"])):h("",!0)}],["__scopeId","data-v-78d339c1"]]);const S=y({name:"wu-image",mixins:[i,s,{props:{src:{type:String,default:""},mode:{type:String,default:"aspectFill"},width:{type:[String,Number],default:300},height:{type:[String,Number],default:255},shape:{type:String,default:"square"},radius:{type:[String,Number],default:0},lazyLoad:{type:Boolean,default:!0},lazyLoadRootMargin:{type:[String,Number],default:-5},minLoadginShowTime:{type:[String,Number],default:30},showMenuByLongpress:{type:Boolean,default:!0},loadingIcon:{type:String,default:"photo"},errorIcon:{type:String,default:"info-circle"},showLoading:{type:Boolean,default:!0},showError:{type:Boolean,default:!0},fade:{type:Boolean,default:!0},webp:{type:Boolean,default:!1},duration:{type:[String,Number],default:500},bgColor:{type:String,default:"#f3f4f6"}}}],data(){return{isError:!1,loading:!0,opacity:1,durationTime:this.duration,backgroundStyle:{},show:!1,loadingImage:!1}},watch:{src:{immediate:!0,handler(t){t?(this.isError=!1,this.loading=!0):this.isError=!0}}},computed:{wrapStyle(){let t={};return t.width=this.$w.addUnit(this.width),t.height=this.$w.addUnit(this.height),t.borderRadius="circle"==this.shape?"10000px":this.$w.addUnit(this.radius),t.overflow=t.borderRadius>0?"hidden":"visible",this.$w.deepMerge(t,this.$w.addStyle(this.customStyle))}},mounted(){this.show=!0,this.lazyLoad?this.IntersectionObserver(this,".wu-image",(t,e)=>{t.intersectionRatio>0&&(this.loadingImage=!0,e())}):this.loadingImage=!0},methods:{onClick(){this.$emit("click")},onErrorHandler(t){this.loading=!1,this.isError=!0,this.$emit("error",t)},onLoadHandler(t){setTimeout(()=>{this.loading=!1},this.minLoadginShowTime),this.isError=!1,this.$emit("load",t),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}}}},[["render",function(t,e,i,s,d,y){const f=g,$=p(c("wu-icon"),w),S=u,b=p(c("wu-transition"),v);return a(),o(b,{mode:"fade",show:d.show,duration:t.fade?1e3:0},{default:n(()=>[m(S,{class:"wu-image",onClick:y.onClick,style:l([y.wrapStyle,d.backgroundStyle])},{default:n(()=>[!d.isError&&d.loadingImage?(a(),o(f,{key:0,src:t.src,mode:t.mode,onError:y.onErrorHandler,onLoad:y.onLoadHandler,"show-menu-by-longpress":t.showMenuByLongpress,class:"wu-image__image",style:l({borderRadius:"circle"==t.shape?"10000px":t.$w.addUnit(t.radius),width:t.$w.addUnit(t.width),height:t.$w.addUnit(t.height)})},null,8,["src","mode","onError","onLoad","show-menu-by-longpress","style"])):h("",!0),t.showLoading&&d.loading?(a(),o(S,{key:1,class:"wu-image__loading",style:l({borderRadius:"circle"==t.shape?"50%":t.$w.addUnit(t.radius),backgroundColor:this.bgColor,width:t.$w.addUnit(t.width),height:t.$w.addUnit(t.height)})},{default:n(()=>[r(t.$slots,"loading",{},()=>[m($,{name:t.loadingIcon,width:t.width,height:t.height},null,8,["name","width","height"])],!0)]),_:3},8,["style"])):h("",!0),t.showError&&d.isError&&!d.loading?(a(),o(S,{key:2,class:"wu-image__error",style:l({borderRadius:"circle"==t.shape?"50%":t.$w.addUnit(t.radius),width:t.$w.addUnit(t.width),height:t.$w.addUnit(t.height)})},{default:n(()=>[r(t.$slots,"error",{},()=>[m($,{name:t.errorIcon,width:t.width,height:t.height},null,8,["name","width","height"])],!0)]),_:3},8,["style"])):h("",!0)]),_:3},8,["onClick","style"])]),_:3},8,["show","duration"])}],["__scopeId","data-v-f32412fb"]]);export{S as _};
